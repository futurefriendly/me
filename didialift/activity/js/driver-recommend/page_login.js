window.addEventListener("DOMContentLoaded",function(){function e(e){removeClass(e,c.BTN_GRAY),addClass(e,c.BTN_ORANGE)}function n(e){removeClass(e,c.BTN_ORANGE),addClass(e,c.BTN_GRAY)}var t=dd.base||{},a=dd.dialog||{},o=(document.getElementById("botton"),document.getElementById("content")),l=document.getElementById("page-up");o.addEventListener("touchmove",function(e){e.preventDefault()},!1),l.addEventListener("touchmove",function(e){e.preventDefault()},!1),t.touch(botton,function(){addClass(o,"content-hide"),addClass(l,"page-show")});var d=document,s=d.getElementById("ipt-phone"),r=d.getElementById("btn-valid"),i=d.getElementById("ipt-validcode"),u=d.getElementById("nextstep"),c={BTN_ORANGE:"btn-orange",BTN_GRAY:"btn-gray",RE_GET:"重新获取"};!function(){var o=!1;s.addEventListener("input",function(){s.value=s.value.replace(/[^\d]/g,"").slice(0,11);var t=s.value,a=/^(13|14|15|17|18)[0-9]{9}$/;t&&a.test(t)&&11===t.length?(e(r),o=!0,i.value&&4===i.value.length&&e(u)):(n(r),n(u))},!1),t.touch(r,function(){if(hasClass(r,c.BTN_ORANGE)){var e=30,n=setInterval(function(){removeClass(r,c.BTN_ORANGE),addClass(r,c.BTN_GRAY),r.innerText=e+"秒",0>=e&&(clearInterval(n),r.innerText=c.RE_GET,removeClass(r,c.BTN_GRAY),addClass(r,c.BTN_ORANGE)),e--},1e3),o=d.getElementById("code_sn"),l=d.getElementById("oldsign"),i=d.getElementById("sign"),u="/qcode/driverportal/sendmessage";t.ajax({url:u,method:"post",data:{phone:s.value.trim(),code_sn:o.value,sign:l.value},succFunc:function(e){e=JSON.parse(e),0===e.errno?(o.value=e.info.code_sn,i.value=e.info.sign,localStorage.sign=e.info.sign):a.alert(e.errmsg)},failFunc:function(){a.alert("您的网络不给力哟，稍后再试~")}})}}),i.addEventListener("input",function(){i.value=i.value.replace(/[^\d]/g,"").slice(0,4);var e=i.value;e&&4===e.length&&o?(removeClass(u,c.BTN_GRAY),addClass(u,c.BTN_ORANGE)):(removeClass(u,c.BTN_ORANGE),addClass(u,c.BTN_GRAY))},!1),t.touch(u,function(){if(!hasClass(u,c.BTN_GRAY)){i.blur(),s.blur();var e=(s.value,i.value,"/qcode/driverportal/bindqcode"),n=d.getElementById("code_sn"),o=d.getElementById("sign");o||(o=localStorage.sign),t.ajax({url:e,method:"post",data:{phone:s.value.trim(),code_sn:n.value,sign:o.value,messageCode:i.value.trim()},succFunc:function(e){e=JSON.parse(e);var n="/qcode/entrance/loadBindSuccessPage?type=";0==e.errno?location.href=n+"0":1005==e.errno?location.href=n+"1":1004==e.errno?location.href=n+"3":a.alert(e.errmsg)},failFunc:function(){a.alert("您的网络不给力哟，稍生再试~")}})}})}()},!1);