document.addEventListener("DOMContentLoaded",function(){function e(){ajax({method:"GET",url:"/imall/get_integral/index?token="+_+"&lat="+T+"&lng="+I+"&datatype="+getQuerySting().datatype+"&version="+getQuerySting().version,succFunc:function(e){var t=txtToJson(e);0==t.errno&&(p.innerHTML=t.score.score_available)},failFunc:function(){}})}function t(e,t,n,a){e.style.height=parseInt(v*n*a/t)+"px"}function n(){if(0==x){o.show();var e=template("wheel_list",b);r.innerHTML=e;var t,n,a,i;r.addEventListener("touchstart",function(e){e.preventDefault(),t=e.changedTouches[0].pageX,n=e.changedTouches[0].pageY},!1),r.addEventListener("touchmove",function(e){e.preventDefault(),a=e.changedTouches[0].pageX,i=e.changedTouches[0].pageY,X=a-t,Y=i-n,(Math.abs(X)>=20||Math.abs(Y)>=20)&&e.target.setAttribute("moved","true")},!1),r.addEventListener("touchend",function(e){return e.preventDefault(),"true"==e.target.getAttribute("moved")?(e.target.setAttribute("moved","false"),void 0):(link(e.target,function(){o.show()}),e.target.setAttribute("moved","false"),void 0)},!1),r.getElementsByTagName("img").length>0?r.getElementsByTagName("img")[0].onload=function(){o.hide()}:(r.style.display="none",o.hide());var l=d.getElementById("indicator"),s=b.wheel_item;if(s&&s.length>0){for(var g=s.length,c=0;g>c;c++){var u=d.createElement("span");l.appendChild(u)}l.children[0].className="on"}asyncLoadJS("http://static.xiaojukeji.com/activity/js/shop/s-wheel.js",function(){"function"==typeof r&&r()})}else 3008==x||dd.dialog.alert({icon:{url:"http://static.xiaojukeji.com/activity/img-mall/error.png",width:"7px",height:"42px"},tip:k,title:"",btn:{val:"我知道啦",handler:function(){}}})}function a(){ajax({method:"GET",url:"/imall/gold_area?token="+_+"&lat="+T+"&lng="+I+"&datatype="+getQuerySting().datatype+"&version="+getQuerySting().version+"&source="+L,succFunc:function(e){var t=txtToJson(e);if(0==t.errno){var n=t.data;if(n.length&&n.length>0){var a=n[0],i=n[1],l=n[2],o=template("gold_list_fir",a);if(c.innerHTML=o,i){var d=template("gold_list_sec",i);u.innerHTML+=d}if(l){var r=template("gold_list_sec",l);u.innerHTML+=r}load_img(g)}else g.style.display="none"}else g.style.display="none"},failFunc:function(){g.style.display="none"}})}function i(){var e={};if(j.length&&j.length>0){e.classify_item=j;var t=template("classify_list",e);s.innerHTML=t;for(var n=s.getElementsByTagName("img"),a=0;a<n.length;a++)!function(e){n[e].onload=function(){n[e].style.display="block"}}(a)}else s.style.display="none"}function l(){ajax({method:"GET",url:"/imall/topic_area?token="+_+"&lat="+T+"&lng="+I+"&datatype="+getQuerySting().datatype+"&version="+getQuerySting().version+"&source="+L,succFunc:function(e){var t=txtToJson(e);if(0==t.errno){var n=t.data;if(n.length&&n.length>0){for(var a=0;a<n.length;a++)if(0!=n[a].items.length){var i=n[a],l=template("modules_list",i);m.innerHTML+=l}load_img(m)}else m.style.display="none"}else m.style.display="none"},failFunc:function(){m.style.display="none"}})}var o=null;o=new dd.dialog.Fn('<div class="loading-logo"></div>'),o.show(),o.hide(),shareFn();var d=document,r=d.getElementById("wheel"),s=d.getElementById("classify"),g=(s.getElementsByTagName("div"),d.getElementById("gold")),c=d.getElementById("gold_left"),u=d.getElementById("gold_right"),m=d.getElementById("modules"),h=d.getElementById("goods"),y=d.getElementById("count"),f=d.getElementById("record"),p=d.getElementById("myCount"),v=(d.getElementById("iphone"),d.getElementsByTagName("body")[0],document.documentElement.clientWidth),E=d.getElementById("law"),_=d.getElementById("token").value,w=d.getElementById("wheel_info").value,B=d.getElementById("classify_info").value,T=d.getElementById("lat").value,I=d.getElementById("lng").value,x=d.getElementById("errno").value,k=d.getElementById("errmsg").value,L=d.getElementById("source").value,b=txtToJson(w),j=txtToJson(B);t(r,375,117,1),t(g,140,174,.44),n(),a(),i(),l(),sys(),load_page("back_index_top");var S={share_url:"http://pay.xiaojukeji.com/api/v2/weixinapi?page=middlepage",share_icon_url:"http://static.diditaxi.com.cn/activity/img-mall/share.jpg",share_img_url:"http://static.diditaxi.com.cn/activity/img-mall/share.jpg",share_title:"有积分享福利，任性兑换不花钱",share_content:"滴滴积分商城天天上新品：水果零食、休闲购物、生活娱乐、鲜花礼品，好礼兑不停",share_from:"滴滴打车"};window.didi&&didi.initShare(S,function(){}),window.addEventListener("popstate",function(){o.hide(),e()},!1),window.onscroll=window.onresize=function(){load_img(m)},diff_platform({android:function(){addClass(E,"law-pad")},ios:function(){}}),y.addEventListener("click",function(){o.show(),location.href="/imall/integral_flow?token="+_+"&lat="+T+"&lng="+I+"&datatype="+getQuerySting().datatype+"&version="+getQuerySting().version},!1),f.addEventListener("click",function(){o.show(),location.href="/imall/change_log/index?token="+_+"&lng="+I+"&lat="+T},!1),touch(h,function(e){var t=d.body.scrollTop||d.documentElement.scrollTop;localStorage.back_index_top=t,link(e.target,function(){o.show()})},!1),touch(E,function(){o.show(),location.href="/imall/help/law"},!1)},!1);