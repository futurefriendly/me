document.addEventListener("DOMContentLoaded",function(){function e(e){diff_platform({android:function(){},ios:function(){e()}})}function n(){var n=I.detail,t=n.description,l={shareId:getQuerySting().id,shareImg:n.list_picture_url,shareTitle:n.name},a=template("btn_list",I);u.innerHTML=a;var d=s.getElementById("imgUrl"),c=(s.getElementById("name"),s.getElementById("merchant_name"),s.getElementById("describe")),h=(s.getElementById("goods_count"),s.getElementById("btn"));if(i(l),d.onload=function(){r.hide()},e(function(){E=s.getElementById("describe2"),T=s.getElementById("goods_count2"),b=s.getElementById("btn2"),addClass(c,"des1"),removeClass(E,"hide")}),""==w&&0!=t.length){for(var p=t?I.detail.description.length:0,f="",v=0;p>v;v++)if(t[v].title&&t[v].cont){var x="<div class='content'><p>"+t[v].title+"：</p><p>"+t[v].cont+"</p></div>";f+=x}g.innerHTML=f}else g.innerHTML=w;diff_platform({android:function(){},ios:function(){m.innerHTML+="<div>活动由滴滴打车提供，与设备生产商Apple Inc.公司无关</div>"}}),o(h)}function i(e){var n={share_url:"http://pay.xiaojukeji.com/api/v2/weixinapi?page=middlepage&productid="+e.shareId,share_icon_url:e.shareImg,share_img_url:e.shareImg,share_title:"我在滴滴积分商城发现了【"+e.shareTitle+"】速去抢兑",share_content:"滴滴积分商城好礼换不停。",share_from:"滴滴打车"};window.didi&&didi.initShare(n,function(){}),document.addEventListener("WeixinJSBridgeReady",function(){WeixinJSBridge.call("showOptionMenu"),WeixinJSBridge.call("hideToolbar");var n={general_config:{img_url:e.shareImg,sharetitle:"我在滴滴积分商城发现了【"+e.shareTitle+"】速去抢兑",sharedesc:"滴滴积分商城好礼换不停。",link:"http://pay.xiaojukeji.com/api/v2/weixinapi?page=middlepage&productid="+e.shareId}},i=n.general_config;WeixinJSBridge.on("menu:share:appmessage",function(){WeixinJSBridge.invoke("sendAppMessage",{appid:"wx69b6673576ec5a65",img_url:i.img_url,img_width:"",img_height:"",link:i.link,title:i.sharetitle,desc:i.sharedesc},function(){})}),WeixinJSBridge.on("menu:share:timeline",function(){WeixinJSBridge.invoke("shareTimeline",{img_url:i.img_url,img_width:"",img_height:"",link:i.link,title:i.sharetitle,desc:i.sharedesc},function(){})})})}function t(){var e=document.body.scrollTop||document.documentElement.scrollTop,n=document.documentElement.clientWidth,i=750,t=422,o=parseInt(t*n/i);e>=o?addClass(describe,"pos_fixed"):removeClass(describe,"pos_fixed")}function o(e){e&&"btn-gray"==e.className||(0==B?touch(e,function(){dd.dialog.confirm({text:"确认兑换",icon:{url:"http://static.xiaojukeji.com/activity/img-mall/s-exchange.png",width:"28px",height:"23px"},confirm:{handler:function(){c=new dd.dialog.Fn('<div class="loading-logo"></div>'),c.show(),l()}}})},!1):1==B?touch(e,function(){a(),l()},!1):touch(e,function(){d(k.error)},!1))}function l(){ajax({method:"GET",timeout:{millisecond:1e4,callback:function(){btn.className="btn-org",d(k.timeout)}},url:"/imall/exchange/index?token="+p+"&product_id="+v+"&lng="+x+"&lat="+y+"&"+_,succFunc:function(e){var e=txtToJson(e),n=e.errno,i=e.errmsg;100==n?location.href="/imall/change_log/index?token="+p+"&product_id="+v+"&lng="+x+"&lat="+y:101==n||201==n?d(k.noFull):200==n?setTimeout(function(){h.style.display="none",d(k.win)},3e3):202==n?setTimeout(function(){h.style.display="none",d(k.noWin)},3e3):2005==n||3002==n||3003==n||3004==n||3005==n?d(i):d("出了点问题稍后再试")},failFunc:function(){h.style.display="none",d(k.error),btn.className="btn-org"}})}function a(){var e=dd.dialog.Fn(h);e.show()}function d(e){var n=e.icon||"error.png";dd.dialog.alert({icon:{url:"http://static.xiaojukeji.com/activity/img-mall/"+n,width:e.width||"7px",height:e.height||"42px"},tip:e.msg||e,title:"",btn:{val:e.val,handler:function(){e.url&&(location.href=e.url)}}})}var r=null,c=null;r=new dd.dialog.Fn('<div class="loading-logo"></div>'),r.show();var s=document,g=s.getElementById("main"),u=s.getElementById("head"),m=s.getElementById("declare"),h=s.getElementById("draw"),p=s.getElementById("token").value,f=s.getElementById("info").value,v=s.getElementById("id").value,x=s.getElementById("lng").value,y=s.getElementById("lat").value,_=s.getElementById("statistics").value,w=s.getElementById("detail").innerHTML,I=txtToJson(f),B=I.detail.activity_type,E=null,T=null,b=null;localStorage.state="true",window.scrollTo(0,1);var k={noFull:{msg:"您的积分不够,打车赚取更多积分",icon:"s-exchange.png",width:"28px",height:"23px",val:"确定"},win:{msg:"恭喜您,中奖啦~",icon:"yes_win.png",width:"30px",height:"26px",val:"查看详情",url:"/imall/change_log/index?token="+p+"&product_id="+v+"&lat="+y+"&lng"+x},noWin:{msg:"很遗憾呢,没有中奖~",icon:"no_win.png",width:"30px",height:"26px",val:"我知道了"},timeout:{msg:"请求超时",icon:"error.png",width:"7px",height:"42px",val:"我知道了"}};window.addEventListener("popstate",function(){c.hide(),r.hide()},!1),0==I.errno?(n(),t()):d(k.error),window.onscroll=window.onresize=function(){t()}},!1);