document.addEventListener("DOMContentLoaded",function(){function n(){0==w?touch(d,function(){dd.dialog.confirm({text:"确认兑换",icon:{url:"http://static.xiaojukeji.com/activity/img-mall/s-exchange.png",width:"28px",height:"23px"},confirm:{handler:function(){l=new dd.dialog.Fn('<div class="loading-car"><div class="bg"></div><div class="loading-car-icon"></div></div>'),l.show(),t()}}})},!1):1==w?touch(d,function(){e(),t()},!1):touch(d,function(){i(E.error)},!1)}function t(){ajax({method:"GET",timeout:{millisecond:1e4,callback:function(){d.className="btn-org",i(E.timeout)}},url:"/imall/exchange/index?token="+h+"&product_id="+v+"&lng="+f+"&lat="+x,succFunc:function(n){var n=txtToJson(n),t=n.errno,e=n.errmsg;100==t?location.href="/imall/change_log/index?token="+h+"&product_id="+v+"&lng="+f+"&lat="+x:101==t||201==t?i(E.noFull):200==t?setTimeout(function(){m.style.display="none",i(E.win)},3e3):202==t?setTimeout(function(){m.style.display="none",i(E.noWin)},3e3):2005==t||3002==t||3003==t||3004==t||3005==t?i(e):i("出了点问题稍后再试")},failFunc:function(){m.style.display="none",i(E.error),d.className="btn-org"}})}function e(){var n=dd.dialog.Fn(m);n.show()}function i(n){var t=n.icon||"error.png";dd.dialog.alert({icon:{url:"http://static.xiaojukeji.com/activity/img-mall/"+t,width:n.width||"7px",height:n.height||"42px"},tip:n.msg||n,title:"",btn:{val:n.val,handler:function(){n.url&&(location.href=n.url)}}})}var o=null,l=null;o=new dd.dialog.Fn('<div class="loading-car"><div class="bg"></div><div class="loading-car-icon"></div></div>'),o.show(),shareFn();var a=document,d=a.getElementById("btn"),c=a.getElementById("main"),r=a.getElementById("fix_main"),g=a.getElementById("title"),s=a.getElementById("goods_count"),u=a.getElementById("imgUrl"),m=a.getElementById("draw"),h=a.getElementById("token").value,p=a.getElementById("info").value,v=a.getElementById("id").value,f=a.getElementById("lng").value,x=a.getElementById("lat").value,y=txtToJson(p),w=y.detail.activity_type;localStorage.state="true";var E={noFull:{msg:"您的积分不够,打车赚取更多积分",icon:"s-exchange.png",width:"28px",height:"23px",val:"确定"},win:{msg:"恭喜您,中奖啦~",icon:"yes_win.png",width:"30px",height:"26px",val:"查看详情",url:"/imall/change_log/index?token="+h+"&product_id="+v+"&lat="+x+"&lng"+f},noWin:{msg:"很遗憾呢,没有中奖~",icon:"no_win.png",width:"30px",height:"26px",val:"我知道了"},timeout:{msg:"请求超时",icon:"error.png",width:"7px",height:"42px",val:"我知道了"}};if(window.addEventListener("popstate",function(){l.hide(),o.hide()},!1),u.onload=function(){o.hide()},0==y.errno){for(var I=y.detail.description,_=y.detail.description.length,B="",b=0;_>b;b++){var T="<div class='content'><p>"+I[b].title+"：</p><p>"+I[b].cont+"</p></div>";B+=T}diff_platform({android:function(){},ios:function(){r.innerHTML+="<div class='content'><p>活动说明：</p><p>活动由滴滴打车提供，与设备生产商Apple Inc.公司无关</p></div>"}}),c.innerHTML=B;var F=y.detail;g.innerHTML=F.name,u.src=F.detail_picture_url,s.innerHTML=F.score,d.innerHTML=y.btnText}else i(E.error);0==y.btnStatus?(d.className="btn-org",n()):d.className="btn-gray"},!1);