window.addEventListener("DOMContentLoaded",function(){function e(e){var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(n);return null!=t?t[2]:""}function n(n){var t=e("show");if("1"==t){var a=document.getElementById(n);("page-gen-hb-1"===n||"page-gen-hb-2"===n)&&(a.style.backgroundImage='url("http://static.xiaojukeji.com/activity/imgs/recommend/spring_01.png")'),"page-result-1"===n&&(a.style.backgroundImage='url("http://static.xiaojukeji.com/activity/imgs/recommend/spring_03.png")'),("page-grap"===n||"page-result-2"===n)&&(a.style.backgroundImage='url("http://static.xiaojukeji.com/activity/imgs/recommend/spring_02.png")'),a.style.backgroundRepeat="no-repeat"}}function t(e){var n=i.body.clientWidth||i.documentElement.clientWidth,t=1.608*n;e.style.width=n+"px",e.style.height=t+"px",e.style.backgroundSize="100% "+t+"px";for(var a=t/505,r=o.getElesByKls(i.body,"header"),l=o.getElesByKls(i.body,"tip-bubble"),s=r.length-1;s>=0;s--)r[s].style.height=5.2*a+"rem";for(var d=l.length-1;d>=0;d--)l[d].style.height=10*a+"rem";"page-grap"===e.id&&(o.getElesByKls(e,"dv-result")[0].style.top=1.02*a+"rem"),"page-gen-hb-1"===e.id&&(o.getElesByKls(e,"dv-wrap")[0].style.top=31*a+"rem"),"page-gen-hb-2"===e.id&&(o.getElesByKls(e,"dv-wrap")[0].style.top=23.2*a+"rem")}var a,r,i=document,l=[],o=dd.base||{},s=dd.dialog||{},d=["page-grap","page-result-1","page-result-2","page-gen-hb-1","page-gen-hb-2","page-exception"],g={0:"page-gen-hb-1",1:"page-gen-hb-2",2:"page-grap",3:"page-result-1",4:"page-result-2"},u="http://pay.xiaojukeji.com/activity/hongbao/c_recommend/",c="http://pay.xiaojukeji.com/activity/hongbao/c_recommend/wxSource";"1"==e("show")&&(c+="?show=1");{var h={ios:{packageName:"com.xiaojukeji.didi",packageUrl:"diditaxi:passenger",downloadUrl:"https://itunes.apple.com/cn/app/di-di-da-che-zhi-jian-shang/id554499054?ls=1&mt=8"},android:{packageName:"com.sdu.didi.psnger",packageUrl:"didipasnger://didi_apk_intalled_scheme",downloadUrl:"http://dldir1.qq.com/diditaxi/apk/didi_psngr.apk"}},m=i.getElementById("txt-tel"),p=i.getElementById("txt-gen-tel"),f=i.getElementById("hid-page-no"),v=i.getElementById("hid-errno"),y=i.getElementById("hid-errmsg"),_=i.getElementById("btn-open"),b=i.getElementById("btn-gen"),E=i.getElementById("btn-newer-share"),B=i.getElementById("btn-older-share"),x=i.getElementById("btn-hide-cover"),w=(i.getElementById("p-result-tip"),i.getElementById("p-result-banner"),i.getElementById("sp-icon"),i.getElementById("hid-phoneno")),k=i.getElementById("hid-default-phone"),I=i.getElementById("hid-rebate-phone"),T=i.getElementById("hid-check-info"),j=i.getElementById("newer-gift-text");o.getQueryStr()}if("1001"==v.value)return void alert("参数错误，复制链接分享时注意是否复制完整");var N=function(e){if(e&&e.length)for(var n=(function(){return"placeholder"in document.createElement("input")}),t={placeholder:"#888",fill:"#666",tip:"请输入您的手机号"},a=function(e){e.target.value="",e.target.style.color=t.fill},r=function(e){e.target.value="",e.target.color=t.placeholder},i=function(e){n()?e.style.color=t.fill:(e.value=t.tip,e.style.color=t.placeholder,e.addEventListener("focus",a,!1),e.addEventListener("blur",r,!1))},l=e.length-1;l>=0;l--)i(e[l])},S=function(e,n){var t=function(e,n){for(var t=e.length-1;t>=0;t--)if(e[t]===n)return!0;return!1};if(n&&"0"!==n){if("3"===e){"1008"===n&&(r="page-result-1");var a=["1008"];t(a,n)}}else{var i=sessionStorage.SEARCH_NEW_CURRENT_PAGE;r=e.length||!i?g[e]:i}r=r||"page-exception"},J=function(e){var n=i.getElementById("d-wall"),t=i.getElementById("d-wrap");n&&(n.style.display="none"),t&&(t.style.display="none"),"function"==typeof e&&e()},H=function(){var e=i.getElementById("dv-cover");e&&(e.style.height=i.documentElement.scrollHeight+"px",e.style.display="block")},A=function(e){var n=e.target;n.value=n.value.replace(/[^\d]/g,"").slice(0,11);var t="btn-gray";/^1[3|4|5|8|7][0-9]\d{8}$/.test(n.value)&&(t="btn-orange",n.blur()),n===m&&(_.className=t),n===p&&(b.className=t)};if(m.addEventListener("input",A,!1),p.addEventListener("input",A,!1),m.value){var O=m;O.value=O.value.replace(/[^\d]/g,"").slice(0,11);var R="btn-gray";O.value&&11===O.value.length&&(R="btn-orange",O.blur()),O===m&&(_.className=R),O===p&&(b.className=R)}var U=function(e,n){return"btn-orange"!==e.className?!1:(s.loading("正在加载",3e4),e.className="btn-gray",e.innerText=n,m.blur(),void p.blur())},C=function(e,n){J(function(){e.className="btn-orange",e.innerText=n||"确认"})},L=function(e,n){J(function(){e.className="btn-gray",e.innerText=n||"确认",m.value="",p.value=""})},W="ios";o.diffPlatform({android:function(){W="android"},ios:function(){W="ios"},wp:function(){W="wp"}});var K=function(){o.ajax({method:"GET",url:" http://pay.xiaojukeji.com/activity/hongbao/c_recommend/wx_share_succ?phone="+(I.value||w.value)+"&device="+W,succFunc:function(){},failFunc:function(){}})},M=function(n){var t=n.share_url,a=n.share_img_url;return 1==e("show")&&(t=-1!=n.share_url.indexOf("?")?n.share_url+"&show=1":n.share_url+"?show=1"),a="http://static.xiaojukeji.com/activity/imgs/recommend/spring_share.png",{appmsg:{appid:"wx69b6673576ec5a65",link:t,img_url:a,title:n.share_title||" ",desc:n.share_desc||" ",succCB:K},timeline:{appid:"wx69b6673576ec5a65",link:t,img_url:a,title:n.share_title||" ",desc:n.share_desc||" ",succCB:K}}},F=function(e){e&&(i.getElementById("p-gen-succ-tip").innerText="奖励将放入滴滴账户"+e)},D=function(e){e||(e="");for(var n=o.getElesByKls(i.body,"owner-logo"),t=null,a=n.length-1;a>=0;a--)t=n[a],t.style.backgroundImage="url("+e+")"},G=function(n){if(n&&o.isObject(n)){var t,a,r=o.getElesByKls(i.getElementById(n.pageflag),"tip-bubble"),l=o.getElesByKls(i.getElementById(n.pageflag),"newer-gift-text"),s=r[0].getElementsByTagName("p");"page-grap"===n.pageflag&&(t=n.nickname&&"小伙伴"!==n.nickname?"我是滴滴小伙伴 "+(n.nickname||"")+"~":"我是滴滴小伙伴~",a=n.register_days&&n.owner_order_num?"使用滴滴"+n.register_days+"天，叫车"+n.owner_order_num+"次，感觉棒棒哒，邀请你一起来~":"用滴滴感觉棒棒哒，邀请你一起来！"),"page-result-1"===n.pageflag&&0===n.errno&&(t=n.nickname?"Hi，"+n.nickname:"Hi，小伙伴",a="4个小伙伴，3个用滴滴，打车3缺1，就差一个你！"),"page-result-1"===n.pageflag&&"1008"===n.errno&&(t=n.nickname?"Hi，"+n.nickname:"Hi，小伙伴",a="这是你已经领过的红包哦~"),"page-result-2"===n.pageflag&&1004===n.errno&&(t=n.nickname?"Hi，"+n.nickname:"Hi，小伙伴",a="你已经是滴滴小伙伴了，不能领我的邀请红包了哟~",l[0]&&(l[0].innerText="只有新伙伴才能领哦~")),"page-result-2"===n.pageflag&&1005===n.errno&&(t=n.nickname?"Hi，"+n.nickname:"Hi，小伙伴",a="你已经领过小伙伴的邀请红包，快去使用吧~",l[0]&&(l[0].innerText="你已经领过了~")),s[0]&&(s[0].innerText=t),s[1]&&(s[1].innerText=a),"1"==e("show")}},q=function(e){if(e&&e.hb_amount&&e.phone){var n=i.getElementById("lbl-amount"),t=i.getElementById("sp-change-phone");n.innerText=e.hb_amount+"元",t.innerText=e.phone}};o.touch(b,function(e){var t=e.target,r={doing:"正在生成...",reset:"生成红包"};if(U(t,r.doing)!==!1){var i=function(e){dd.dialog.alert({tip:e||"对不起，程序出现了一点问题~",btn:{val:"我知道了",handler:function(){C(t,r.reset)}}}),t.className="btn-orange",t.innerText=txt||"确认"},l=o.txtToJson(T.value);o.ajax({method:"GET",url:u+"ajaxCreateShareUrl?phone="+p.value.trim()+"&unique="+l.unique+"&timestamp="+l.timestamp+"&sign="+encodeURIComponent(l.sign),succFunc:function(e){if(e=o.txtToJson(e),0===e.errno){if(F(e.rebate_phone),e.shareinfo){D(e.shareinfo.owner_header_img);var l=M(e.shareinfo);a&&dd.share.shareAll(a,l)}L(t,r.reset),n("page-gen-hb-2"),X("page-gen-hb-2")}else i(e.errmsg)},failFunc:i})}}),o.touch(_,function(t){var r={doing:"正在打开...",reset:"打开红包"};if(U(t.target,r.doing)!==!1){var l=o.txtToJson(i.getElementById("hid-open-check-info").value),s=u+"receive_result?msisdn="+l.msisdn+"&phone="+m.value.trim(),d=function(e){dd.dialog.alert({tip:e,btn:{val:"我知道了",handler:function(){C(t.target,r.reset)}}})};o.ajax({method:"GET",url:s,succFunc:function(l){if(l=o.txtToJson(l),L(t.target,r.reset),0===l.errno){if(l.info){q(l.info);var s=l.info.mine_share,g=M(s);G({pageflag:"page-result-1",nickname:s&&s.owner_nick_name,errno:l.errno}),dd.share.shareAll(a,g),n("page-result-1"),X("page-result-1"),l.info.seed_url&&(i.getElementById("hid-seed-url").value=l.info.seed_url)}}else if(1004===l.errno||1005===l.errno){if(l.info){var s=l.info.mine_share,g=M(s);G({pageflag:"page-result-2",nickname:s&&s.owner_nick_name,errno:l.errno}),dd.share.shareAll(a,g),n("page-result-2"),X("page-result-2"),l.info.seed_url&&(i.getElementById("hid-seed-url").value=l.info.seed_url)}}else if(1009===l.errno||1011===l.errno)l.info&&("1"==e("show")&&(l.info.seed_url=-1!=l.info.seed_url.indexOf("?")?l.info.seed_url+"&show=1":l.info.seed_url+"?show=1"),location.replace(l.info.seed_url||c));else if(l.errmsg)return void d(l.errmsg)},failFunc:function(){alert("对不起服务器错误,请稍后再试."),C(t.target,r.reset)}})}});var P=function(){var e;o.diffPlatform({ios:function(){e=h.ios},android:function(){e=h.android}}),setTimeout(function(){WeixinJSBridge.invoke("getInstallState",e,function(n){var t=n.err_msg;location.href=t.indexOf("get_install_state:yes")>-1?e.packageUrl:e.downloadUrl})},200)};o.touch(i.getElementById("btn-didiapp"),P,!1),o.touch(i.getElementById("btn-didiapp-2"),P,!1),o.touch(x,function(){var e=i.getElementById("dv-cover");e&&(e.style.display="none")});var z=function(n){if("btn-orange"===n.target.className)if(n.target===E||n.target===B){var t=i.getElementById("hid-seed-url").value;"1"==e("show")&&(t=-1!=t.indexOf("?")?t+"&show=1":t+"?show=1"),location.replace(t||c)}else navigator.userAgent.indexOf("MicroMessenger")>-1&&H()};o.touch(B,z,!1),o.touch(E,z,!1);var $=function(e){var n=function(){WeixinJSBridge&&(a=WeixinJSBridge,a.call("hideOptionMenu"),a.call("hideToolbar"),"function"==typeof e&&e())};"undefined"==typeof WeixinJSBridge?i.addEventListener("WeixinJSBridgeReady",n):n()},Q=function(e){var n=function(){"undefined"!=typeof DidiJSBridge&&"function"==typeof e&&e(DidiJSBridge)};"undefined"==typeof DidiJSBridge?document.addEventListener("DidiJSBridgeReady",n,!1):n()},V=function(n,t){var a=i.getElementById("btn-share-timeline"),r=i.getElementById("btn-share-appmsg"),l=function(n){if(n){var t=n.share_url;return 1==e("show")&&(t=-1!=n.share_url.indexOf("?")?n.share_url+"&show=1":n.share_url+"?show=1"),{share_url:t,share_icon_url:n.share_img_url,share_img_url:n.share_img_url,share_title:n.share_title,share_content:n.share_desc}}};o.touch(a,function(){n.callHandler("share_weixin_timeline",JSON.stringify(l(t)),function(){})}),o.touch(r,function(){n.callHandler("share_weixin_appmsg",JSON.stringify(l(t)),function(){})})},X=function(e){if(l.length){for(var n,a,i=l.length-1;i>=0;i--)n=l[i],a=n&&n.dom,a&&(t(a),a.style.display=e===n.id||e===a?"inline-block":"none");r=e,sessionStorage.SEARCH_NEW_CURRENT_PAGE=e}};!function(){var e=f.value,t=v.value,s=(y.value,!1);if(N([m,p]),function(e){for(var n,t=e.length-1;t>=0;t--)n=i.getElementById(e[t]),n&&l.push({id:e[t],dom:n})}(d),function(){var e=i.getElementById("p-share-button"),n=(i.getElementById("btn-share-timeline"),i.getElementById("btn-share-appmsg"),navigator.userAgent.indexOf("MicroMessenger")>-1);n?(j.innerHTML="点击<span style='color:#fbdd57'>右上角</span>分享邀请红包",j.style.marginTop="5rem",e.style.display="none"):e.style.display="block"}(),function(){w.value&&(p.value=w.value,11===p.value.length&&(b.className="btn-orange")),k.value&&(m.value=k.value,11===m.value.length&&(_.className="btn-orange"))}(),S(e,t),"1"===e){var g=o.txtToJson(i.getElementById("hid-share-info").value);D(g.owner_header_img),F(I.value),$(function(){g&&g.share_url&&dd.share.shareAll(a,M(g))}),Q(function(e){V(e,g)}),s=!0}if("2"===e){var g=o.txtToJson(i.getElementById("hid-share-info").value);D(g.owner_header_img),G({pageflag:"page-grap",nickname:g.owner_nick_name,register_days:g.register_days,owner_order_num:g.owner_order_num}),$(function(){g&&g.share_url&&dd.share.shareAll(a,M(g))}),Q(function(e){V(e,g)}),s=!0}if("3"===e&&"1008"===t){var u=o.txtToJson(i.getElementById("hid-info").value);if(q(u),D(u.owner_header_img),u.mine_share){var c=u.mine_share;G({pageflag:"page-result-1",nickname:c&&c.owner_nick_name,errno:t})}$(function(){dd.share.shareAll(a,M(u.mine_share))}),Q(function(e){V(e,u.mine_share)}),s=!0}s===!1&&$(),n(r),X(r)}()},!1);