<!DOCTYPE html>
<html>

<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no"/>
    <title>滴滴出行</title>
    <script src="http://static.diditaxi.com.cn/api/js/native-price.js" type="text/javascript"></script>
    <style>
        body,
        div,
        span,
        p,
        h2,
        h3,
        h4,
        h5,
        h6 {
            margin: 0;
            padding: 0;
            font-family: 'Microsoft YaHei', arial, sans-serif, 'Droid Sans Fallback';
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }

        html {
            font-size: 12px;
            height: 100%;
        }

        body {
            background-color: #fafafa;
            height: 100%;
        }

        .img-background {
            display: block;
            width: 9.16rem;
            margin: 0rem auto;
            margin-top: 6.91rem;
        }

        .call-taxi {
            margin-top: 6.08rem;
            background-color: #ff8e05;
            color: #ffffff;
        }

        .down-client {
            color: #666666;
            border: 1px solid #e0e0e0;
            margin-top: 1.23rem;
        }

        .newbie-coupon {
            color: #fa8919;
            font-size: 1.2rem;
            font-weight: lighter;
            position: absolute;
            bottom: 2rem;
            width: 100%;
        }

        a {
            display: block;
            width: 27.08rem;
            height: 3.5rem;
            line-height: 3.5rem;
            border-radius: .5rem;
            font-size: 1.6rem;
            text-align: center;
            margin: 0 auto;
            text-decoration: none;
        }

        #logSource {
            display: none;
        }

        #invalid {
            padding-top: 4.58rem;
        }

        .none {
            display: none;
        }

        #invalid div {
            font-size: 1.67rem;
            color: #999999;
            width: 100%;
            text-align: center;
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var _doc           = document;
            var docuW          = _doc.documentElement.clientWidth,
                html           = _doc.getElementsByTagName('html')[0];
            var num            = docuW / 375;
            var defaultChannel = '70077';

            params = undefined;

            html.style.fontSize = 12 * num + "px";

            //QR init
            initQRCodeStatus();

            log('page');

            dd.touch(document.querySelector('.call-taxi'), function () {
                log('call');
                setTimeout(function () {
                    window.location.href = 'http://common.diditaxi.com.cn/general/webEntry?bizid=257&channel=' + getChannel();
                }, 100)
            })

            dd.touch(document.querySelector('.down-client'), function () {
                log('download');
                setTimeout(function () {
                    window.location.href = 'http://dc.tt/r6ZC';
                }, 100)
            })

            function log(strAction) {
                var actionBase = 'taxi_qrcode_call_';
                var url        = 'http://api.diditaxi.com.cn/api/v2/onlinelog?type=taxi_h5';
                url += '&action=' + actionBase + strAction;
                url += '&channel=' + getChannel();
                console.log(url);
                document.querySelector('#logSource').src = url;
            }

            function getChannel() {
                if (!params)
                    params = dd.getQueryStr()

                return params.channel || defaultChannel;
            }

            //初始化页面
            function initQRCodeStatus() {

                var thisChannel = getChannel();
                //若当前获取渠道为默认渠道，则不做处理
                if (defaultChannel == thisChannel) {
                    dd.removeClass(document.querySelector('#valid'), 'none');
                    dd.addClass(document.querySelector('#invalid'), 'none');
                    return;
                }

                var sendData = {
                    url     : 'http://mis.diditaxi.com.cn/crm/qrcode/view/status?channel=' + thisChannel,
                    succFunc: function (data) {
                        data = JSON.parse(data);
                        if (data.errno == '0') {
                            dd.removeClass(document.querySelector('#valid'), 'none');
                            dd.addClass(document.querySelector('#invalid'), 'none');
                        } else {
                            dd.removeClass(document.querySelector('#invalid'), 'none');
                            dd.addClass(document.querySelector('#valid'), 'none');
                        }
                    },
                    failFunc: function () {
                        dd.removeClass(document.querySelector('#valid'), 'none');
                        dd.addClass(document.querySelector('#invalid'), 'none');
                    }
                };

                dd.getJson(sendData);
            }
        }, false);
    </script>
</head>

<body>
<img id='logSource'>
<img class="img-background" src="../imgs/Logo_didi_station.png">
<div id="valid" class="none">
    <a class="call-taxi" href="javascript:void(0);">马上叫出租车</a>
    <a class="down-client" href="javascript:void(0);">下载滴滴客户端</a>
    <a class="newbie-coupon" href="http://s.udache.com/VTUFDU">新用户专享出租车券 戳这里 ></a>
</div>
<div id="invalid" class="none">
    <div>您扫的二维码已失效，</div>
    <div>请登录 微信-我的钱包-滴滴出行 叫车</div>
</div>
</body>

</html>
