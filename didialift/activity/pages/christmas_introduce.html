<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" media="(device-height: 568px)" />
    <title>滴滴打车</title>
    <style type="text/css">
    body {
        margin: 0;
        padding: 0;
    }
    img {
        width: 100%;
        display: block;
    }
    .contant {
        width: 100%;
        overflow: hidden;
    }
    </style>
</head>

<body>
    <div class="contant">
        <img src="../img-mall/christmas_introduce/christmas_introduce_01.png">
        <img src="../img-mall/christmas_introduce/christmas_introduce_02.png">
        <img src="../img-mall/christmas_introduce/christmas_introduce_03.png">
        <img src="../img-mall/christmas_introduce/christmas_introduce_04.png">
        <img src="../img-mall/christmas_introduce/christmas_introduce_05.png">
        <span id="gonative" class="gonative">
            <img src="../img-mall/christmas_introduce/christmas_introduce_06.png">
        </span>
        <img src="../img-mall/christmas_introduce/christmas_introduce_07.png">
    </div>
    <script src="http://static.diditaxi.com.cn/activity/lib/dd.base.js"></script>
    <script type="text/javascript">
        //webapp 调起native
    //分享相关
    var diff_platform = function(opts){
        if ((navigator.userAgent.match(/(Android)/i))) {
            opts.android && opts.android();
        }else if((navigator.userAgent.match(/(iPhone|iPod|ios|iPad)/i))){
            opts.ios && opts.ios();
        }else if((navigator.userAgent.match(/(Windows phone)/i))){
            opts.wp && opts.wp();
        }else{
            opts.others && opts.others();
        }
    };

    document.addEventListener('WeixinJSBridgeReady', function(){
        var obj={
            img_url:"http://static.diditaxi.com.cn/activity/img-mall/christmas_introduce/share80x80.jpg",
            sharetitle:"滴滴圣诞版，人人有礼哦！",
            sharedesc:"圣诞狂欢趴，现在打车圣诞老人带着礼物来接你哦！",
            link:location.href
        };

        WeixinJSBridge.on('menu:share:appmessage', function(argv) {
            WeixinJSBridge.invoke('sendAppMessage', {
                "appid": "wx69b6673576ec5a65",
                "img_url": obj.img_url,
                "img_width": "",
                "img_height": "",
                "link": obj.link,
                "title": obj.sharetitle,
                "desc": obj.sharedesc
            }, function(res) {
            });
        });

        // 分享到朋友圈
        WeixinJSBridge.on('menu:share:timeline', function(argv) {
        WeixinJSBridge.invoke('shareTimeline', {
                "img_url": obj.img_url,
                "img_width": "",
                "img_height": "",
                "link": obj.link,
                "title": obj.sharedesc,
                "desc": obj.sharedesc
            }, function(res) {
            });
        });

        var btns_call_native=document.getElementById("gonative"),
            base = dd.base || {};

        var params = null, btn = null;
        diff_platform({
            ios:function(){
                params = {
                    "packageName":"com.xiaojukeji.didi",
                    "packageUrl":"diditaxi:passenger",
                    "downloadUrl":"https://itunes.apple.com/cn/app/di-di-da-che-zhi-jian-shang/id554499054?ls=1&mt=8"
                };
            },
            android:function(){
                params = {
                    "packageName":"com.sdu.didi.psnger",
                    "packageUrl":"didipasnger://didi_apk_intalled_scheme",
                    "downloadUrl":"http://dldir1.qq.com/diditaxi/apk/didi_psngr_999.apk"
                };
            }
        });

        if(btns_call_native){
            base.touch(btns_call_native,function(ev){
                //检测是否安装了滴滴app
                window.setTimeout(function(){
                    WeixinJSBridge.invoke('getInstallState', params, function(e) {
                        //alert(JSON.stringify(e));
                        var msg = e.err_msg;
                        if(msg.indexOf("get_install_state:yes") > -1) {  
                            window.location.href = params.packageUrl; //检测出已经安装滴滴app则打开微信app
                        }else{
                            window.location.href = params.downloadUrl; //下载滴滴app
                        }
                    });
                },100);

            },false);
        }
    });
    </script>
</body>

</html>
