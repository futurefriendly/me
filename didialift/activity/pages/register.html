<!DOCTYPE html>
<html>

<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no" />
    <title>线下站点分布查询</title>
    <link rel="stylesheet" href="http://static.xiaojukeji.com/webapp/css/ui/dd.ui.datepick.css">
    <script src="http://static.diditaxi.com.cn/api/js/native-price.js" type="text/javascript"></script>
    <script src="http://static.xiaojukeji.com/webapp/lib/swiper.js" type="text/javascript"></script>
    <!-- <script type="text/javascript" src="http://static.diditaxi.com.cn/webapp/ddbridge.js"></script> -->
    <style>
    body,
    div,
    span,
    p,
    h2,
    h3,
    h4,
    h5,
    h6 {
        margin: 0;
        padding: 0;
        font-family: 'Microsoft YaHei', arial, sans-serif, 'Droid Sans Fallback';
        -webkit-user-select: none;
        -webkit-touch-callout: none;
    }
    
    body {
        background-color: white;
    }
    
    .top {
        height: 4.41rem;
        background-color: #f5f5f5;
    }
    
    .top .title {
        width: 100%;
        height: 100%;
        display: block;
        text-align: center;
        font-size: 1.58rem;
        line-height: 4.41rem;
    }
    
    .top .back {
        position: absolute;
        height: 1.67rem;
        width: 0.917rem;
        margin-top: 1.37rem;
        margin-left: 2.67rem;
        background: url(../../api/native/images/rightArrow.png) no-repeat;
        background-size: 100%;
        transform: rotate(180deg);
        -webkit-transform: rotate(180deg);
        display: block;
    }
    
    .tab-region {
        height: 3.67rem;
        border-bottom: 1px solid #ececec;
        display: block;
        position: relative;
    }
    
    .tab-region:after {
        content: '';
        display: block;
        clear: both;
    }
    
    .tab-region .item {
        height: 3.5rem;
        text-align: center;
        border: none;
        width: 50%;
        float: left;
        font-size: 1.33rem;
        line-height: 3.67rem;
    }
    
    .tab-region .selected {
        color: #ff8903;
        border-bottom: 0.2rem #ff8903 solid;
    }
    
    .main {
        width: 26.67rem;
        display: block;
        margin: 0 auto;
        background-color: white;
    }
    
    .main .second-title {
        /*font-size: 1.167rem;*/
        line-height: 2.2rem;
        font-size: 1.333rem;
        color: #bbbbbb;
        display: block;
        padding-bottom: 1.83rem;
        padding-top: 1.83rem;
        padding-left: 1rem;
        padding-right: 1rem;
    }
    
    .main .select-city {
        height: 4rem;
        border-bottom: 1px solid #e0e0e0;
        border-top: 1px solid #e0e0e0;
        line-height: 4rem;
        font-size: 1.333rem;
        padding-left: 1rem;
        padding-right: 1rem;
        color: #ff8903;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    }
    
    .main .select-city:after {
        display: block;
        background: url(../imgs/register/down.png) no-repeat;
        background-size: 100%;
        content: '';
        width: .56rem;
        height: 1.67rem;
        float: right;
        position: absolute;
        margin-top: -2.5rem;
        margin-right: 3rem;
        right: 1rem;
    }
    
    .main #location_region .title {
        font-size: 1.33rem;
        margin-top: 2.25rem;
        display: block;
        padding-left: 1rem;
        letter-spacing: .1rem;
    }
    
    #location_region ul {
        list-style: none;
        margin-top: 0.96rem;
        display: block;
        font-size: 1.17rem;
        /*padding-left: .2rem;*/
    }
    
    #location_region ul > li {
        margin-left: -1rem;
        margin-top: 1rem;
        font-size: 1.33rem;
    }
    
    #location_region ul > li:first-child {
        margin-top: 0;
    }
    
    #location_region ul > li > div.address {
        /*display: flex;*/
        line-height: 2rem;
    }
    
    #location_region ul > li > div.address .address-content {
        /*flex: 1;*/
        display: block;
        padding-left: 7rem;
    }
    
    #location_region ul > li > div.address > .title {
        padding-left: 0;
        margin-top: 0 !important;
        width: 7rem;
        float: left;
        position: absolute;
    }
    
    #location_region ul > li > div {
        /*float: left;*/
    }
    
    #location_region ul > li:before {
        display: block;
        background: url(../imgs/register/location.png) no-repeat;
        background-size: 100%;
        content: '';
        width: 1rem;
        height: 1.67rem;
        position: absolute;
        margin-left: -1.3rem;
        margin-top: .15rem;
    }
    
    .none {
        display: none !important;
    }
    
    .font-black {
        /*color: #333333 !important;*/
        line-height: 1.6rem;
    }
    
    .list-title {
        width: 26.67rem;
        text-align: center;
        display: block;
        z-index: 10;
        position: absolute;
    }
    
    .list-title:after {
        content: '';
        clear: both;
    }
    
    .list-title > div {
        background-color: white;
        width: 5rem;
        margin: 0 auto;
        margin-top: -.7rem;
        font-size: 1.16rem;
        color: #878787;
    }
    
    .line {
        display: block;
        width: 100%;
        height: 1px;
        border-top: 1px solid #eeeeee;
        /*margin-top: rem;*/
        z-index: 1;
    }
    
    #audit ul {
        list-style: none;
        padding: 1rem;
        margin-top: 1.83rem;
    }
    
    #audit ul > li {
        margin-top: 2.3rem;
    }
    
    #audit ul > li:nth-child(1) {
        margin-top: 0rem !important;
    }
    
    #audit ul > li .title {
        font-size: 1.33rem;
        /*margin-left: 1rem;*/
        /*width: 23.33rem;*/
        margin: 0 auto;
    }
    
    #audit ul > li .second-title {
        /*width: 23.33rem;*/
        font-size: 1.23rem;
        padding: 0;
        margin: 0 auto;
        line-height: 2.5rem;
    }
    
    #audit .img {
        width: 23.67rem;
        height: 16rem;
        /*margin-left: .2rem;*/
        margin: 0 auto;
    }
    
    .foot {
        height: 3rem;
        display: block;
    }
    
    .foot:before {
        content: '';
        display: block;
        clear: both;
    }
    </style>
</head>

<body class="none">
    <!--<div class="top none" id="topRegion">-->
        <!--<span class="title">滴滴出租车司机注册</span>-->
    <!--</div>-->
    <!--<div class="tab-region">-->
        <!--<div class="item selected" target="location_region">线下站点分布</div>-->
        <!--<div class="item" target="audit">审核标准</div>-->
    <!--</div>-->
    <div class="main">
        <div id="location_region">
            <span class="second-title">若您在注册时遇到困难,可到当地线下地点找工作人员协助.</span>
            <div class="select-city" id="selectCity">选择车辆所属地区</div>
            <div>
                <span class="title none" id='stationInfoTitle'>站点信息:</span>
                <ul id="addressList">
                </ul>
            </div>
        </div>
        <div id="audit" class="none">
            <span class="second-title font-black">亲爱的各位师傅，注册滴滴司机需提交如下几个证件，请尽量参照各个证件的审核标准严格执行，这样您才可以快速地审核通过，然后使用滴滴高效抢单哦!</span>
            <div class="list-title">
                <div>资料上传</div>
            </div>
            <div class="line"></div>
            <ul>
                <li>
                    <div class="title">行驶证</div>
                    <span class="second-title">出租客运，证件清晰，信息全部展示</span>
                    <div class="img" style="background:url(../imgs/register/DrivingLicense.png);background-size: contain;background-repeat: no-repeat;"></div>
                    <!--<div class="img"></div>-->
                </li>
                <li>
                    <div class="title">驾驶证</div>
                    <span class="second-title">有效期内，证件清晰，信息全部展示</span>
                    <div class="img" style="background:url(../imgs/register/license.png);background-size: contain;background-repeat: no-repeat;"></div>
                </li>
                <li>
                    <div class="title">从业资格证</div>
                    <span class="second-title">有效期内，证件清晰，信息全部展示</span>
                    <div class="img" style="background:url(../imgs/register/Qualifications.png);background-size: contain;background-repeat: no-repeat;"></div>
                </li>
                <li>
                    <div class="title">监督卡</div>
                    <span class="second-title">有效期内，需证件清晰，信息全部展示</span>
                    <div class="img" style="background:url(../imgs/register/Supervision.png);background-size: contain;background-repeat: no-repeat;"></div>
                </li>
                <li>
                    <div class="title">人车合影</div>
                    <span class="second-title">人车合影正面照，能看清人、车牌、顶灯 </span>
                    <div class="img" style="background:url(../imgs/register/ManCar.png);background-size: contain;background-repeat: no-repeat;"></div>
                </li>
            </ul>
        </div>
    </div>
    <div class="foot"></div>
</body>
<script>
var dataJson = {};

function bodyScroll(e) {
    e.preventDefault();
}

function addPre() {
    document.querySelector('body').addEventListener('touchmove', bodyScroll, false);
}

function removePre() {
    document.querySelector('body').removeEventListener('touchmove', bodyScroll, false);
}

//datePicker核心插件
var mlkDatePicker = {
    dateDom: null,
    init: function(opts) {
        this.creatDom(opts.obj);
        this.renderDom(opts.slideChangeFn, opts.seting);
        this.btnFn(opts.callbackFn);
    },
    homing: function(index) {
        var doc = document;
        var swiperW = doc.querySelectorAll('.swiper-wrapper');
        var thisSwiper = swiperW[index];
        var eachSwiper = thisSwiper.querySelectorAll('.swiper-slide');
        var trans3dStep = 50;
        var rotX = 25;
        thisSwiper.style.webkitTransform = 'translate3d(0px, 0px, 0px)';
        thisSwiper.style.transform = 'translate3d(0px, 0px, 0px)';
        thisSwiper.style.webkitTransitionDuration = '.2s';
        thisSwiper.style.transitionDuration = '.2s';
        [].forEach.call(eachSwiper, function(item, index) {
            item.style.webkitTransform = 'translate3d(0px, 0px, -' + trans3dStep * index + 'px) rotateX(' + rotX * index + 'deg) rotateY(0deg)';
            item.style.transform = 'translate3d(0px, 0px, -' + trans3dStep * index + 'px) rotateX(' + rotX * index + 'deg) rotateY(0deg)';
        });
        eachSwiper[0].className = 'swiper-slide swiper-slide-active';
        eachSwiper[1] && (eachSwiper[1].className = 'swiper-slide swiper-slide-next');
    },
    creatDom: function(obj) {
        var objLength = obj.length;
        if (objLength <= 0) return;
        var swiperWith = 100 / objLength;
        var doc = document;
        var pageBody = doc.querySelector('body');
        var fragment = doc.createDocumentFragment();
        //创建box
        var wrapperBox = doc.createElement('div');
        var swWrapper = doc.createElement('div');
        var swHeader = doc.createElement('div');
        var btnCancel = doc.createElement('div');
        var btnDo = doc.createElement('div');
        var swSlots = doc.createElement('div');
        var swiperOuter = doc.createElement('div');
        var swiperMask = doc.createElement('div');
        wrapperBox.id = 'wrapper-box';
        swWrapper.id = 'sw-wrapper';
        swHeader.id = 'sw-header';
        btnCancel.id = 'sw-cancel';
        btnCancel.innerHTML = '取消';
        btnDo.id = 'sw-done';
        btnDo.innerHTML = '确认';
        swSlots.id = 'sw-slots-wrapper';
        swiperOuter.className = 'swiper-outer';
        swiperMask.className = 'swiper-mask';
        wrapperBox.appendChild(swWrapper);
        swWrapper.appendChild(swHeader);
        swWrapper.appendChild(swSlots);
        swHeader.appendChild(btnCancel);
        swHeader.appendChild(btnDo);
        swSlots.appendChild(swiperOuter);
        swSlots.appendChild(swiperMask);

        obj.forEach(function(item, index) {
            //创建外层
            var swiperContainer = doc.createElement('div');
            var swiperWrapper = doc.createElement('div');
            swiperContainer.className = 'swiper-container';
            swiperContainer.style.width = swiperWith + '%';
            swiperContainer.id = 'swiper-' + index;
            swiperWrapper.className = 'swiper-wrapper';
            swiperContainer.appendChild(swiperWrapper);
            var eachListFragment = doc.createDocumentFragment();
            item.forEach(function(sitem) {
                //创建每个list
                var swiperSlider = doc.createElement('div');
                swiperSlider.className = 'swiper-slide';
                swiperSlider.innerHTML = sitem.name;
                swiperSlider.setAttribute('data-val', sitem.val);
                eachListFragment.appendChild(swiperSlider);
            });
            swiperWrapper.appendChild(eachListFragment);
            fragment.appendChild(swiperContainer);
        });
        swiperOuter.appendChild(fragment);
        pageBody.appendChild(wrapperBox);
        swWrapper.className = 'up';
        this.dateDom = wrapperBox;
    },
    renderDom: function(callback, seting) {
        var selectAll = document.getElementsByClassName('swiper-container');
        var swiperObj = [];
        //禁止页面在微信或者别的native中滑动
        addPre();
        var thisSeting = seting ? seting : {
            effect: 'coverflow', //动画模式
            freeMode: true, //free模式
            freeModeSticky: true, //使得freeMode也能自动贴合。
            coverflow: {
                rotate: 50, //slide做3d旋转时Y轴的旋转角度。默认50。
                stretch: 0, //每个slide之间的拉伸值，越大slide靠得越紧。 默认0
                depth: 100, //slide的位置深度。值越大z轴距离越远，看起来越小。 默认100。
                modifier: 0.5, //depth和rotate和stretch的倍率，相当于depth*modifier、rotate*modifier、stretch*modifier，值越大这三个参数的效果越明显。默认1。
                slideShadows: false //开启slide阴影。默认 true。
            },
            direction: 'vertical',
            onTransitionEnd: function(swiper) { //当释放slider时执行
                if (callback) {
                    //过度结束就执行回调
                    setTimeout(function() {
                        callback(swiper, swiperObj);
                    }, 100);
                }
            }
        };
        [].forEach.call(selectAll, function(item, index) {
            var mySwiper = new Swiper('#' + item.id, thisSeting);
            swiperObj.push({
                obj: mySwiper
            });
        });
    },
    btnFn: function(callback) {
        var doc = document;
        var btnCancel = doc.querySelector('#sw-cancel');
        var btnDo = doc.querySelector('#sw-done');
        var dateBox = doc.querySelector('#wrapper-box');
        var dateCont = doc.querySelector('#sw-wrapper');
        var dateDom = this.dateDom;
        dateCont.addEventListener('click', function(ev) {
            ev.stopPropagation();
        }, false);
        dateBox.addEventListener('click', function(ev) {
            doc.querySelector('body').removeChild(dateDom);
            removePre()
        }, false);
        btnCancel.addEventListener('touchend', function() {
            doc.querySelector('body').removeChild(dateDom);
            removePre()
        }, false);
        btnDo.addEventListener('touchend', function() {
            var slideActive = document.getElementsByClassName('swiper-slide-active');
            var resObj = [];
            [].forEach.call(slideActive, function(item) {
                var resEach = {
                    name: item.innerHTML,
                    val: item.getAttribute('data-val')
                };
                resObj.push(resEach);
            });
            if (callback) {
                callback(resObj);
                doc.querySelector('body').removeChild(dateDom);
                removePre()
            }
        }, false);
    },
    reInit: function(opts) {
        var reInitArray = opts.obj;
        var reInitSwipers = opts.swipers;
        if (reInitArray.length <= 0) return;
        var doc = document;
        var swiperOuter = doc.querySelector('.swiper-outer');
        var swiperWrap = swiperOuter.querySelectorAll('.swiper-wrapper');
        for (var i = 0; i < reInitArray.length; i++) {
            if (reInitArray[i].length <= 0) continue; //跳出进行下轮循环
            var eachListFragment = doc.createDocumentFragment();
            reInitArray[i].forEach(function(sitem) {
                //创建每个list
                var swiperSlider = doc.createElement('div');
                swiperSlider.className = 'swiper-slide';
                swiperSlider.innerHTML = sitem.name;
                swiperSlider.setAttribute('data-val', sitem.val);
                eachListFragment.appendChild(swiperSlider);
                eachListFragment.appendChild(swiperSlider);
            });
            swiperWrap[i].innerHTML = '';
            swiperWrap[i].appendChild(eachListFragment);
            var thisSwiper = reInitSwipers[i].obj;
            thisSwiper.update();
            this.homing(i);
        }
    }
};


window.onload = function() {
    var _doc = document;
    var docuW = _doc.documentElement.clientWidth,
        html = _doc.getElementsByTagName('html')[0];
    var num = docuW / 375;

    html.style.fontSize = 12 * num + "px";

    var params = dd.getQueryStr();
    if (!params.native) {
        //dd.removeClass(document.querySelector('#topRegion'), 'none');
    }
    dd.removeClass(document.querySelector('body'), 'none');

    bind();
    dd.getJson({
        url: 'http://mis.diditaxi.com.cn/kefu/api/site_info/index',
        succFunc: function(data) {
            data = JSON.parse(data);
            if (data.errno == 0) {
                dataJson = data.data;
            } else {
                alert(data.errmsg);
            }
        },
        failFunc: function() {
            console.log(arguments);
        }
    });


}

function bind() {

    //tab 事件
    var arrayObj = document.querySelectorAll('.tab-region > .item');
    for (var i = 0; i < arrayObj.length; i++) {
        (function() {
            var ele = arrayObj[i];
            dd.touch(ele, function() {
                var idStr = ele.getAttribute('target');
                if (!dd.hasClass(ele, 'selected')) {

                    //处理tab页
                    var selectObj = document.querySelector('.selected');
                    dd.removeClass(selectObj, 'selected');
                    dd.addClass(ele, 'selected')

                    var needHideIdStr = selectObj.getAttribute('target');
                    dd.addClass(document.querySelector('#' + needHideIdStr), 'none');
                    dd.removeClass(document.querySelector('#' + idStr), 'none');

                }
            })
        })();
    }


    document.querySelector('body').addEventListener('click', function() {});
    document.querySelector('#selectCity').addEventListener('click', function() {
        console.log('11');
        mlkDatePicker.init({
            obj: [dataJson, dataJson[0].child], //传入数组，数组内为渲染列的数组
            slideChangeFn: function(swiper, swipers) { //滑动结束后回调
                console.log(swiper);
                //获取本次拖拽对象的container
                var thisContainer = swiper.container[0];
                //console.log(swiper.container[0].id);
                //滑动天选择器
                if (thisContainer.id === 'swiper-0') {
                    var swiperIndex = swiper.activeIndex;


                    mlkDatePicker.reInit({
                        obj: [
                            [], dataJson[swiperIndex].child
                        ], //重新渲染的数组
                        swipers: swipers
                    });
                }
            },
            callbackFn: function(obj) { //点击确定回调

                //移除站点信息的title
                dd.removeClass(document.querySelector('#stationInfoTitle'), 'none');
                // console.log(obj);

                var liHtml = ' <li><div class="address"><div class="title">站点地址:</div><div class="address-content">{address}</div></div>{time}<br/>{phone}</li>';

                var addressList = getAddress(obj[0].val, obj[1].val);

                var html = '';
                for (var i = 0; i < addressList.length; i++) {
                    var _liHtml = liHtml.replace(/\{address\}/img, addressList[i].address);
                    _liHtml = _liHtml.replace(/\{time\}/img, addressList[i].time);
                    _liHtml = _liHtml.replace(/\{phone\}/img, addressList[i].phone);
                    html += _liHtml;
                }

                document.querySelector('#addressList').innerHTML = html;
                document.querySelector('#selectCity').innerHTML = obj[0].name + '-' + obj[1].name;

            }
        });
    }, false);
}


//获取地址数据
function getAddress(firstId, secondId) {

    for (var i = 0; i < dataJson.length; i++) {

        var thisJson = dataJson[i];
        if (dataJson[i].val == firstId)
            for (var _i = 0; _i < thisJson.child.length; _i++) {
                if (thisJson.child[_i].val == secondId) {
                    return thisJson.child[_i].child;
                }
            }
    }
}

// // 分享数据
// var shareData = {
//     share_url: 'http://static.diditaxi.com.cn/site/pages/olders-taxi/index.html?v=' + Math.random(),
//     share_icon_url: 'http://static.diditaxi.com.cn/site/pages/olders-taxi/images/share.jpg',
//     share_img_url: 'http://static.diditaxi.com.cn/site/pages/olders-taxi/images/share.jpg',
//     share_title: '父母打不到出租车怎么办？',
//     share_content: '10月20日滴滴出租车“敬老专线”正式开通，以后爸妈打车不再困难！快来告知父母吧！',
//     share_from: '滴滴出行'
// };

// if (window.didi) {
//     didi.initShare(shareData, function () {
//         console.log('分享成功');
//     });
// }
</script>

</html>
