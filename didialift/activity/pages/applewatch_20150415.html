<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>滴滴免费送Apple Watch</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <style type="text/css">
    html,
    body{
        margin: 0;
        padding: 0;
        background:#fff;
    }
    img {
        margin: 0;
        padding: 0;
        width: 100%;
        height: auto;
        display: block;
    }
    #linkShare {
        display: none;
    }
    #linkShare img {
        margin: 0 auto;
    }
    #divShare {
        top: 0;
        position: fixed;
        background-position: center;
        background-size: cover;
        z-index: 999;
        width: 100%;
        height: 100%;
        display: none;
        background-image: url('http://static.diditaxi.com.cn/webapp/images/mask-share.png');
    }
    </style>
</head>

<body>
    <img src="http://static.diditaxi.com.cn/activity/imgs/applewatch_20150415/applewatch_01.jpg">
    <img src="http://static.diditaxi.com.cn/activity/imgs/applewatch_20150415/applewatch_02.jpg">
    <a href="" id="draw">
        <img src="http://static.diditaxi.com.cn/activity/imgs/applewatch_20150415/applewatch_03.jpg">
    </a>
    <img src="http://static.diditaxi.com.cn/activity/imgs/applewatch_20150415/applewatch_04.jpg">
    <img src="http://static.diditaxi.com.cn/activity/imgs/applewatch_20150415/applewatch_05.jpg">
    <img src="http://static.diditaxi.com.cn/activity/imgs/applewatch_20150415/applewatch_06.jpg">
    <img src="http://static.diditaxi.com.cn/activity/imgs/applewatch_20150415/applewatch_07.jpg">
    <img src="http://static.diditaxi.com.cn/activity/imgs/applewatch_20150415/applewatch_08.jpg">
    <a href="javascript:void(0);" id="linkShare">
        <img src="http://static.diditaxi.com.cn/activity/imgs/applewatch_20150415/applewatch_12.jpg">
    </a>
    <img src="http://static.diditaxi.com.cn/activity/imgs/applewatch_20150415/applewatch_10.jpg">
    <div class="share" id="divShare"></div>
</body>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(ev) {
    var draw = document.getElementById('draw');

    function getQueryStr() {
        var item, key, val, res = {};
        var queryStr = (location.search.length) ? location.search.substring(1) : '';

        if (!queryStr) return res;
        if (queryStr.indexOf('&') === -1 && queryStr.indexOf('=') > -1) {
            item = queryStr.split('=');
            key = decodeURIComponent(item[0]);
            val = decodeURIComponent(item[1]);
            if (key) res[key] = val || "";
            return res;
        }
        if (queryStr.indexOf('&') > -1) {
            items = queryStr.split('&');
            for (var i = 0, len = items.length; i < len; i++) {
                item = items[i].split('=');
                key = decodeURIComponent(item[0]);
                val = decodeURIComponent(item[1]);
                if (key) res[key] = val;
            };
            return res;
        }
    };

    function returnUrl(id) {
        var _url = 'http://diditaxi.com.cn/imall/detail?id=' + id + '&token=' + getQueryStr().token + '&lat=' + getQueryStr().lat + '&lng=' + getQueryStr().lng;
        return _url;
    }

    if(getQueryStr().type=="shop"){
        draw.href="http://pay.xiaojukeji.com/api/v2/weixinapi?page=middlepage";
    }else{
        draw.href=returnUrl(6080);
    }
    //微信分享
    document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
        var share_config = {
            general_config: {
                img_url: 'http://static.diditaxi.com.cn/activity/imgs/applewatch_20150415/share.jpg',
                sharetitle: "滴滴免费送Apple Watch", 
                sharedesc: "滴滴积分商城内100积分抽一次，小滴等你来，万一中了呢~",
                link: "http://static.diditaxi.com.cn/activity/pages/applewatch_20150415.html?type=shop"
            }
        };
        var obj = share_config.general_config;
        WeixinJSBridge.on('menu:share:appmessage', function(argv) {
            WeixinJSBridge.invoke('sendAppMessage', {
                "appid": "wx69b6673576ec5a65",
                "img_url": obj.img_url,
                "img_width": "",
                "img_height": "",
                "link": obj.link,
                "title": obj.sharetitle,
                "desc": obj.sharedesc
            }, function(res) {

            });
        });
        // 分享到朋友圈
        WeixinJSBridge.on('menu:share:timeline', function(argv) {
            WeixinJSBridge.invoke('shareTimeline', {
                "img_url": obj.img_url,
                "img_width": "",
                "img_height": "",
                "link": obj.link,
                "title": obj.sharetitle,
                "desc": obj.sharedesc
            }, function(res) {});
        });

        var linkShare = document.getElementById('linkShare');
        var divShare = document.getElementById("divShare");
        linkShare.style.display="block";
        linkShare.addEventListener("touchstart", function(ev) {
            divShare.style.display = "block";
        }, false);
        divShare.addEventListener("touchstart", function(ev) {
            divShare.style.display = "none";
        }, false);
    }, false);
    //app分享
    (function(window) {
        var linkShare = document.getElementById('linkShare');

        // 连接DidiJSBridge
        var connectDidiJSBridge = function(callback) {
            if (window.DidiJSBridge) {
                callback(DidiJSBridge);
            } else {
                document.addEventListener('DidiJSBridgeReady', function() {
                    //alert('这是DIDIJSBridge' + DidiJSBridge);
                    callback(DidiJSBridge);
                }, false);
            }
        };

        var shareData = {
            share_url: "http://static.diditaxi.com.cn/activity/pages/applewatch_20150415.html?type=shop", // 分享出去的URL
            share_icon_url: 'http://static.diditaxi.com.cn/activity/imgs/applewatch_20150415/share.jpg', // 分享⼩图icon
            share_img_url: 'http://static.diditaxi.com.cn/activity/imgs/applewatch_20150415/share.jpg', // 分享⼤图
            share_title: '滴滴免费送Apple Watch',
            share_content: '滴滴积分商城内100积分抽一次，小滴等你来，万一中了呢~',
            share_from: 'native' // 分享来源，便于做统计
        };
        // 操作入口的配置信息
        var entranceCfg = {
            entrance: { // ⼊⼝本⾝的icon可定制，不限于微信的右上⾓三个点
                icon: ''
            },
            buttons: [ {
                    type: 'share_weixin_timeline',
                    name: '分享到微信朋友圈',
                    data: {
                        share_url: shareData.share_url, // 分享出去的URL
                        share_icon_url: shareData.share_icon_url, // 分享⼩图icon
                        share_img_url: shareData.share_icon_url, // 分享⼤图
                        share_title: shareData.share_title,
                        share_content: shareData.share_content,
                        share_from: shareData.share_from // 分享来源，便于做统计
                    },
                    callback: function() {}
                }, {
                    type: 'share_weixin_appmsg',
                    name: '分享给微信好友',
                    data: {
                        share_url: shareData.share_url, // 分享出去的URL
                        share_icon_url: shareData.share_icon_url, // 分享⼩图icon
                        share_img_url: shareData.share_icon_url, // 分享⼤图
                        share_title: shareData.share_title,
                        share_content: shareData.share_content,
                        share_from: shareData.share_from // 分享来源，便于做统计
                    },
                    callback: function() {}
                }, {
                    type: 'share_qq_appmsg',
                    name: '分享给QQ好友',
                    data: {
                        share_url: shareData.share_url, // 分享出去的URL
                        share_icon_url: shareData.share_icon_url, // 分享⼩图icon
                        share_img_url: shareData.share_icon_url, // 分享⼤图
                        share_title: shareData.share_title,
                        share_content: shareData.share_content,
                        share_from: shareData.share_from // 分享来源，便于做统计
                    },
                    callback: function() {}
                }, {
                    type: 'share_qzone',
                    name: '分享到QQ空间',
                    data: {
                        share_url: shareData.share_url, // 分享出去的URL
                        share_icon_url: shareData.share_icon_url, // 分享⼩图icon
                        share_img_url: shareData.share_icon_url, // 分享⼤图
                        share_title: shareData.share_title,
                        share_content: shareData.share_content,
                        share_from: shareData.share_from // 分享来源，便于做统计
                    },
                    callback: function() {}
                }
                //, {
                //     type: 'web_redirect', // ⾃定义的按钮
                //     name: '打⻋券使⽤规则',
                //     icon: 'http://static.diditaxi.com.cn/webapp/images/driver.png',
                //     redirect_url: 'http://www.baidu.com'
                //}
            ]
        };
        // 执行连接DidiJSBridge
        connectDidiJSBridge(function(bridge) {
            if (typeof bridge === 'undefined') {
                //alert('还没有这个DidiJSBridge对象，吧啦吧啦啦');
                return;
            }
            linkShare.style.display="block";
            // use bridge object
            bridge.callHandler('init_entrance', JSON.stringify(entranceCfg)); // 初始入口

            linkShare.addEventListener("touchend", function(e) {
                if (typeof bridge === 'undefined') {
                    //alert('别坑我啊⼤哥，JSBridge对象⽊有加载成功啊.');
                    return;
                }            
                // console.log(it.method);
                bridge.callHandler("invoke_entrance");
            }, false);
        });

    })(window, undefined);

}, false);

</script>

</html>
