<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>滴滴打车</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <style type="text/css">
    html,
    body {
        margin: 0;
        padding: 0;
        background: #fff;
    }
    img {
        margin: 0;
        padding: 0;
        width: 100%;
        height: auto;
        display: block;
        -webkit-tap-highlight-color:rgba(0,0,0,0);
    }
    #linkShare {
        display: none;
    }
    #divShare {
        top: 0;
        position: fixed;
        background-position: center;
        background-size: cover;
        z-index: 999;
        width: 100%;
        height: 100%;
        display: none;
        background-image: url('http://static.diditaxi.com.cn/webapp/images/mask-share.png');
    }
    #down{
        display: none;
    }
    a{
        -webkit-tap-highlight-color:rgba(0,0,0,0);
    }
    </style>
</head>

<body>
    <img src="../imgs/pizza/pizza_01.jpg">
    <img src="../imgs/pizza/pizza_02.jpg">
    <img src="../imgs/pizza/pizza_03.jpg?v=2">
    <img src="../imgs/pizza/pizza_04.jpg">
    <img src="../imgs/pizza/pizza_05.jpg">
    <img src="../imgs/pizza/pizza_06.jpg">
    <img src="../imgs/pizza/pizza_07.jpg">
    <img src="../imgs/pizza/pizza_08.jpg">
    <a href="pizza_add.html">
        <img src="../imgs/pizza/pizza_09.jpg">
    </a>
    <img src="../imgs/pizza/pizza_10.jpg?v=2">
    <a href="pizza_add.html">
        <img src="../imgs/pizza/pizza_16.jpg">
    </a>
    <img src="../imgs/pizza/pizza_11.jpg">
    <img src="../imgs/pizza/pizza_12.jpg" id="down">
    <img src="../imgs/pizza/pizza_13.jpg">
    <a href="javascript:void(0);" id="linkShare">
        <img src="../imgs/pizza/pizza_14.jpg" />
    </a>
    <img src="../imgs/pizza/pizza_15.jpg">
    <div class="share" id="divShare"></div>
</body>
<script type="text/javascript" src="http://diditaxi.com.cn/activity/hongbao/static/webapp/didi.min.js"></script>
<script type="text/javascript">

//微信分享
document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
    var share_config = {
        general_config: {
            img_url: 'http://static.diditaxi.com.cn/activity/imgs/pizza/share.jpg',
            sharetitle: "滴滴带你到必胜客免费喝饮料啦", 
            sharedesc: "6月2日-6月16日，使用滴滴叫出租车到达必胜客门店500米内即可获得免费喝饮料",
            link: location.href
        }
    };
    var obj = share_config.general_config;
    WeixinJSBridge.on('menu:share:appmessage', function(argv) {
        WeixinJSBridge.invoke('sendAppMessage', {
            "appid": "wx69b6673576ec5a65",
            "img_url": obj.img_url,
            "img_width": "",
            "img_height": "",
            "link": obj.link,
            "title": obj.sharetitle,
            "desc": obj.sharedesc
        }, function(res) {

        });
    });
    // 分享到朋友圈
    WeixinJSBridge.on('menu:share:timeline', function(argv) {
        WeixinJSBridge.invoke('shareTimeline', {
            "img_url": obj.img_url,
            "img_width": "",
            "img_height": "",
            "link": obj.link,
            "title": obj.sharetitle,
            "desc": obj.sharedesc
        }, function(res) {});
    });

    var linkShare = document.getElementById('linkShare'),
        divShare = document.getElementById("divShare"),
        down = document.getElementById("down");

    linkShare.style.display = "block";
    down.style.display = "block";

    linkShare.addEventListener("touchstart", function(ev) {
        divShare.style.display = "block";
    }, false);
    divShare.addEventListener("touchstart", function(ev) {
        divShare.style.display = "none";
    }, false);

    //打开滴滴app
    var diff_platform = function(opts){
        if ((navigator.userAgent.match(/(Android)/i))) {
            opts.android && opts.android();
        }else if((navigator.userAgent.match(/(iPhone|iPod|ios|iPad)/i))){
            opts.ios && opts.ios();
        }else if((navigator.userAgent.match(/(Windows phone)/i))){
            opts.wp && opts.wp();
        }else{
            opts.others && opts.others();
        }
    }
    var params = null;
    diff_platform({
        ios:function(){
            params = {
                "packageName":"com.xiaojukeji.didi",
                "packageUrl":"diditaxi:passenger",
                "downloadUrl":"https://itunes.apple.com/cn/app/di-di-da-che-zhi-jian-shang/id554499054?ls=1&mt=8"
            };
        },
        android:function(){
            params = {
                "packageName":"com.sdu.didi.psnger",
                "packageUrl":"didipasnger://didi_apk_intalled_scheme",
                "downloadUrl":"http://dldir1.qq.com/diditaxi/apk/didi_psngr_999.apk"
            };
        }
    });
    touch(down,function(){
        window.setTimeout(function(){
            WeixinJSBridge.invoke('getInstallState', params, function(e) {
                //alert(JSON.stringify(e));
                var msg = e.err_msg;
                if(msg.indexOf("get_install_state:yes") > -1) {  
                    window.location.href = params.packageUrl; //检测出已经安装滴滴app则打开微信app
                }else{
                    window.location.href = params.downloadUrl; //下载滴滴app
                }
            });
        },100);

    },false);

}, false);

//app分享
(function(window) {
    var linkShare = document.getElementById('linkShare');
    // 连接DidiJSBridge
    var connectDidiJSBridge = function(callback) {
        if (window.DidiJSBridge) {
            callback(DidiJSBridge);
        } else {
            document.addEventListener('DidiJSBridgeReady', function() {
                //alert('这是DIDIJSBridge' + DidiJSBridge);
                callback(DidiJSBridge);
            }, false);
        }
    };

    var shareData = {
        share_url: location.href, // 分享出去的URL
        share_icon_url: 'http://static.diditaxi.com.cn/activity/imgs/pizza/share.jpg', // 分享⼩图icon
        share_img_url: 'http://static.diditaxi.com.cn/activity/imgs/pizza/share.jpg', // 分享⼤图
        share_title: '滴滴带你到必胜客免费喝饮料啦',
        share_content: '6月2日-6月16日，使用滴滴叫出租车到达必胜客门店500米内即可获得免费喝饮料',
        share_from: 'native' // 分享来源，便于做统计
    };
    // 操作入口的配置信息
    var entranceCfg = {
        entrance: { // ⼊⼝本⾝的icon可定制，不限于微信的右上⾓三个点
            icon: ''
        },
        buttons: [{
                type: 'share_weixin_timeline',
                name: '微信朋友圈',
                data: {
                    share_url: shareData.share_url, // 分享出去的URL
                    share_icon_url: shareData.share_icon_url, // 分享⼩图icon
                    share_img_url: shareData.share_icon_url, // 分享⼤图
                    share_title: shareData.share_title,
                    share_content: shareData.share_content,
                    share_from: shareData.share_from // 分享来源，便于做统计
                },
                callback: function() {}
            }, {
                type: 'share_weixin_appmsg',
                name: '微信好友',
                data: {
                    share_url: shareData.share_url, // 分享出去的URL
                    share_icon_url: shareData.share_icon_url, // 分享⼩图icon
                    share_img_url: shareData.share_icon_url, // 分享⼤图
                    share_title: shareData.share_title,
                    share_content: shareData.share_content,
                    share_from: shareData.share_from // 分享来源，便于做统计
                },
                callback: function() {}
            }
        ]
    };
    // 执行连接DidiJSBridge
    connectDidiJSBridge(function(bridge) {
        if (typeof bridge === 'undefined') {
            //alert('还没有这个DidiJSBridge对象，吧啦吧啦啦');
            return;
        }
        linkShare.style.display = "block";
        
        // use bridge object
        bridge.callHandler('init_entrance', JSON.stringify(entranceCfg)); // 初始入口

        linkShare.addEventListener("touchend", function(e) {
            if (typeof bridge === 'undefined') {
                //alert('别坑我啊⼤哥，JSBridge对象⽊有加载成功啊.');
                return;
            }
            // console.log(it.method);
            bridge.callHandler("invoke_entrance");
        }, false);
    });

})(window, undefined);
</script>

</html>
