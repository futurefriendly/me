dd.ready(function(){var e=dd.base,n=(dd.dialog,null),t=document.getElementsByClassName("page"),a=document.getElementById("ul-list"),o=document.getElementById("others");pageno=pageno||1,errno=errno||0,hb_info=e.txtToJson(hb_info)||{},theme_config=e.txtToJson(theme_config)||{},all_hb_info=e.txtToJson(all_hb_info)||{};var i=theme_config.receiver&&theme_config.receiver.max_display_count||15,r={1:"page-grab",2:"page-result",3:"page-error",4:"page-changephone"},l={};l.resPageStMap={0:{tip:theme_config.page_wording&&theme_config.page_wording.success_txt||"恭喜您抢代金券成功了！！！"},301:{tip:"这是你已经领过的代金券了哦～"},302:{tip:theme_config.page_wording&&theme_config.page_wording.finish_txt||"对不起，此代金券已被抢完~"},303:{tip:"这个代金券过期了... "},304:{tip:"代金券还没开抢，晚点再来！"},305:{tip:"运气不够，没领到代金券~"},401:{tip:"不能再领这个代金券了哦～"},5001:{tip:"服务器忙，稍后再试试～"},5004:{tip:"签名验证失败~"}};var s=function(e,a){for(var o=0,i=t.length;i>o;o++)t[o].style.display="none";n=document.getElementById(r[e]),n.style.display="block";var s=function(n,t){var o=t.getElementsByClassName("bubble")[0];o.innerHTML=2==e?l.resPageStMap[a]&&l.resPageStMap[a].tip||"程序员哥哥出现了让人无法理解的错误~":1==e?n.page_wording&&n.page_wording.phone_txt:l.resPageStMap[a]&&l.resPageStMap[a].tip||"程序员哥哥出现了让人无法理解的错误~"};s(theme_config,n)},c=function(e,n){var t=function(e,n){var t=n.getElementsByClassName("head")[0];t.src=2==hb_info.type?e.sender&&e.sender.sender_img_url||"http://static.xiaojukeji.com/pinche/hongbao/images/hb-head.png":all_hb_info.create&&all_hb_info.create.headimgurl||"http://static.xiaojukeji.com//pinche/hongbao/images/hb-head.png"},a=function(e){var n=e.page_bg_img||{},t=document.body,a=window.screen.width;321>a?(t.style.background="url('"+n.top_small_img+"')  no-repeat",t.style.backgroundSize="100% auto"):(t.style.background="url('"+n.top_big_img+"')  no-repeat",t.style.backgroundSize="100% auto")},o=function(e,n){var t=e.extra_btn;if(t){var a='<a class="btn-orange" name="link" data-href="'+(t.btn_extra_link||"")+'">'+(t.btn_extra_name||"")+"</a>",o=n.getElementsByClassName("letter")[0];o.innerHTML+=a}},i=function(e,n){t(e,n),a(e),o(e,n)};i(e,n)},g=function(e,t){var i=function(e){var t=document.getElementById("coupon");if(0==errno||301==errno)t.className="coupon "+(e.bonus_type||""),t.innerHTML=(e.amount||0)+"<em>元</em>",phone.innerHTML=e.phone||"";else{t.style.display="none";var a=n.getElementsByClassName("title")[0];a.innerHTML=l.resPageStMap[errno]&&l.resPageStMap[errno].tip||"程序员哥哥出现了让人无法理解的错误~"}},r=function(e,n){var t=e.list_info||[],i="",r=t.length>n?n:t.length;if(0===r)return void(i='<li class="empty">暂无小朋友抢代金券</li>');for(var l=0;r>l;l++)i+='<li><img src="'+(t[l].headimgurl||"http://static.xiaojukeji.com/pinche/hongbao/images/hb-head.png")+'" width="32px" height="32px"><div class="detail">',i+='<span class="name">'+(t[l].nickname||"滴滴小伙伴")+"</span>",i+='<span class="time">'+(t[l].create_time||"")+"</span>",i+='<b class="amount">'+(t[l].amount||0)+"元</b>",i+='<p class="comment">以后出门就靠你了，么么哒~</p></div></li>';a.innerHTML=i,o.style.display="block"};i(e),r(e,t)},d=function(){for(var n=document.getElementsByName("btnDownload"),t=0,a=n.length;a>t;t++)e.touch(n[t],function(){e.diffPlatform({ios:function(){location.href="https://itunes.apple.com/cn/app/di-di-da-che-zhi-jian-shang/id554499054?ls=1&mt=8"},android:function(){location.href="http://dldir1.qq.com/diditaxi/apk/didi_psngr.apk"}})})},p=function(){for(var n=document.getElementsByName("link"),t=null,a=0,o=n.length;o>a;a++)t=n[a],e.touch(n[a],function(){location.href=t.getAttribute("data-href")})},m=function(){var t=document.getElementById("txt-phone"),a=document.getElementById("btnOpen"),o=function(t){var o=dd.dialog.loading("请求中，请稍后..."),r="?openid="+encodeURIComponent(hb_info.openid)+"&phone="+encodeURIComponent(t);for(var l in hb_info)r+="&"+l+"="+hb_info[l];e.ajax({method:"GET",url:"/beatles_hb/EHongbao/getPayHBAjax"+r,succFunc:function(t){t=e.txtToJson(t)||{},setTimeout(function(){o.hide()},300),pageno=t.pageno||pageno,errno=t.errno||errno,s(pageno,errno),c(theme_config,n),2==t.pageno&&g(t,i)},failFunc:function(){dd.dialog.alert("网络请求失败，请稍后重试"),a.className="btn-orange"}})},r=function(e){return/^1[3|4|5|8|7][0-9]\d{8}$/.test(e)?!0:!1},l=function(){var e=t.value.trim();a.className=11===e.length?"btn-orange":"btn-gray"};t.addEventListener("input",l,!1),t.addEventListener("focus",l,!1),e.touch(a,function(){if("btn-gray"!=a.className){a.className="btn-gray";var e=t.value.trim();this.blur(),r(e)?o(e):dd.dialog.alert("手机号填写错误~")}})};s(pageno,errno),c(theme_config,n),"2"==pageno&&g(all_hb_info,i),"1"==pageno&&m(),p(),d()});