<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>滴滴顺风车</title>
    <link rel="stylesheet" type="text/css" href="/static/common/css/merged-common-ui.css">
    <link rel="stylesheet"  href="../static/css/didi-orange.css">
</head>


<body>
       
        <!-- 横屏提示层 -->
        <div class="wrong-layer-one fullLayer-one" id="wrongLayer">
            <div class="abs-mm ta-c">
                <img src="http://static.xiaojukeji.com/pinche/images/subwaydog/wrong.png" style="width:74px;height:110px;">
                <br>
                <div class="placeBlock-20"></div>
                <span class="size14" style="color:#fff;font-size:1.4rem">为了更好的体验，请使用竖屏浏览</span>
            </div>
        </div>

         <script type="text/javascript">
           var fullLayerOne = document.querySelector('.fullLayer-one');
           if(window.innerHeight>window.innerWidth){
           	  fullLayerOne.style.height= window.innerWidth + "px";
           }else{
           	  fullLayerOne.style.height= window.innerHeight + "px";
           }
        </script>

       <input type="hidden" value="1" id="task">
		<!-- 顶部logo -->
		<div class="didi-orange-title">
			<img src="../static/img/didi-passenger-title.jpg">
		</div>

		<!-- 活动内容 -->
		<div class="didi-orange-task borderB">
			<div class="didi-task-pic">
				<img src="../static/img/2.jpg">
			</div>
			<h1>邀请奖励无上限</h1>
			<p>每邀请1位好友成为车主（且他在桔色星期一完成1单）可获得<span style="color:#ff8903">20-30元</span>奖励，奖励次数无上限</p>
		</div>

		<div class="didi-orange-task">
			<div class="didi-task-pic">
				<img src="../static/img/1.jpg">
			</div>
			<h1>周一免费乘坐顺风车</h1>
			<p>7月13日、7月20日进入滴滴打车客户端<br/>免费乘坐顺风车</p>
		</div>

		<div class="bottom-none" id="task-bottom">
			<!-- 判断登录状态 -->
			<a href="javascript:void(0)" class="go-task" id="go-task">马上拿奖励</a>
			<a href="<?php echo $backurl;?>" class="go-back">查看车主奖励
				<span class="arrow"><img src="../static/img/arrow.jpg"></span>
			</a>
		</div>


        <!-- 验证码 -->
        <div class="didi-dilog didi-code-alert">
			 <div class="content_tel">
			 	 <!-- 关闭按钮 -->
			 	 <div class="didi-close">
			 	 	<img src="../static/img/didi-close.png">
			 	 </div>
				 <ul class="cont_ul">
				 	 <li><p>验证手机号,奖励才能找到你哦</p></li>
					 <li class="li_phone form">
					 	<input type="tel" placeholder="填写手机号" id="phone" class="phone_i" maxlength="11"><a href="javascript:;" id="btnCheck" class="btnCheck">验证</a>
					 </li>
					 <li class="form">
					 	<input type="tel" placeholder="输入验证码" id="code" class="valide_i"  maxlength="4">
					 </li>
					 <li>
					 	<a href="javascript:;" class="chose_btn" id="chose_btn">确定</a>
					 </li>
				 </ul>
			 </div>
        </div>

        <!-- 警告栏 -->
        <div class="didi-dilog didi-tips">
			 <div class="content_tel content-tips">
				  <div class="didi-close">
				 	 <img src="../static/img/didi-close.png">
				  </div>
                  <div class="didi-tips-pic"><img src="../static/img/tips.jpg"></div>
                  <p class="didi-tips-text">你已是顺风车车主,选择车主奖励更多哦</p>
                  <a href="javascript:;" class="go-prize go-prize1" id="go-prize1">拿乘客奖励</a>
                  <a href="javascript:;" class="go-prize" id="go-prize">拿车主奖励</a>
			 </div>
        </div>

<script src="/static/common/js/zepto.js"></script>
<script type="text/javascript" src="/static/common/js/merged-base-dialog.js"></script>
<script>

function orient() {
        if (window.orientation == 0 || window.orientation == 180) {
        $('#wrongLayer').hide();
        return false;
        }
        else if (window.orientation == 90 || window.orientation == -90) {
        $('#wrongLayer').show();
        return false;
        }
	    }
	    $(window).bind('orientationchange', function(e){
	        orient();
	    });

$(function(){
	  var   phone = $("#phone"),
	        code = $("#code"),
	        btnSubmit = $("#chose_btn"),
	        btnCheck = $("#btnCheck"),
	        goTask = $("#go-task"),
	        close = $('.didi-close'),
	        task = $('#task'),
	       	invitephoneText = /[?&]invitephone=([^&]*)/.test(location.search) && RegExp.$1,
	        channelText = /[?&]channel=(\d+)/.test(location.search) && RegExp.$1,
	        countdown = 60;
	  var reg1=/^1[3|4|5|8|7][0-9]\d{8}$/; 

	    if(invitephoneText){
	    	invitephoneValues = invitephoneText;
	    }else{
	    	invitephoneValues=0
	    }

	    if(channelText){
	        channelValues = parseInt(channelText);
	    }else{
	        channelValues=0
	    }
        // 判断登录状态状态
	    goTask.bind('touchend',function(){
	    	var _this=$(this);
	    	if($(this).hasClass('hover')){
	    		return;
	    	}
	        $(this).addClass('hover'); 
	        $.ajax({
	    		type:'GET',
	    		url:'<?php echo $dotaskurl;?>',
	    		timeout:'5000',
				success:function(data){
				    _this.removeClass('hover');
				    var da=JSON.parse(data);
					console.log('弹窗'+da);
	                if(da.errno==0){
	                	location.href=da.data.url;
	                }else if(da.errno==101){
	                   $('.didi-code-alert').css('display','block');
					}else{
						$('.didi-tips').css('display','block');
						$('#go-prize').bind('click',function(){
	                		location.href=da.data.url;
	                	});

	                	$('#go-prize1').bind('click',function(){
	                		location.href=da.data.purl;
	                	})
					}
				},
	            error:function(){
	            	_this.removeClass('hover');
					dd.dialog.alert("网络请求失败，请稍后重试");
				}
	    	})
	    })

	    close.bind('touchend',function(){
	        phone.blur();
	        code.blur();
	       $('.didi-dilog').css('display','none');
	        event.preventDefault();
	    })

	    btnSubmit.bind('touchend',function(){
	    	var _this=$(this);

    	if(!reg1.test(phone.val())){
	    	$('.didi-code-alert').css('display','none');
		         dd.dialog.alert({tip:"请输入正确的手机号码",btn:{val:'确定',handler:function(){
			         $('.didi-code-alert').css('display','block')
			      }}});
		    return;
	    }

	    if(code.val()==''){
	    	$('.didi-code-alert').css('display','none');
	          dd.dialog.alert({tip:"验证码不能为空",btn:{val:'确定',handler:function(){
		           $('.didi-code-alert').css('display','block')
		          }}});
            return
        }

	        phone.blur();
	        code.blur();
	    	$.ajax({
	    		type:'POST',
	    		url:'<?php echo $url_login;?>',
	    		data:{'phone':phone.val(),'code':code.val(),'invitephone':invitephoneValues,'channel':channelValues,'task':task.val()},
	    		timeout:'5000',
				success:function(data){
				var da=JSON.parse(data);
					console.log(data);
	                if(da.errno==0){
	                   if(da.registered == 0){
	                     	window.location.href= da.data.url;
	                    }else{
	                    	window.location.href=da.data.url;
	                    }
	                }
	                else if(da.errno == 103)
	                {
	                	$('.didi-tips').css('display','block');
						$('#go-prize').bind('click',function(){
	                		location.href=da.data.url;
	                	});

	                	$('#go-prize1').bind('click',function(){
	                		location.href=da.data.purl;
	                	})
	                }
					else{
	                    $('.didi-code-alert').css('display','none');
	                    dd.dialog.alert({tip:da.errmsg,btn:{val:'确定',handler:function(){
	                       $('.didi-code-alert').css('display','block')
	                    }}});
					}

				},
	            error:function(){
	                    $('.didi-code-alert').css('display','none');
	                    dd.dialog.alert({tip:"网络请求失败,请稍后重试",btn:{val:'确定',handler:function(){
	                       $('.didi-code-alert').css('display','block')
	                    }}});
				}
	    	})
	    });

	    phone.bind('focus',function(){
		    if($(this).hasClass('err_inp')){
		      $(this).removeClass('err_inp')
		    }
		  });

    //验证
	    btnCheck.bind('touchend',function(){
	    	var _this=$(this);
	         if(phone.val() == ""){
	    	  $('.didi-code-alert').css('display','none');
	          dd.dialog.alert({tip:"手机不能为空",btn:{val:'确定',handler:function(){
		           $('.didi-code-alert').css('display','block')
		       }}});
	          return;
	        }
	    	if(!reg1.test(phone.val())){
	    	  $('.didi-code-alert').css('display','none');
	          dd.dialog.alert({tip:"手机号填写有误",btn:{val:'确定',handler:function(){
		           $('.didi-code-alert').css('display','block')
		       }}});
		      return;
		    }
	        if(btnCheck.hasClass('btnGray')) {
	            return
	        }
	       
	    	phone.blur();
	        code.blur();
	        $.ajax({
	        	url:'<?php echo $url_getcode;?>'+ phone.val(),
	        	timeout:'5000',
	        	success:function(data){
					var json=JSON.parse(data);

					console.log(json);
					if (json.errno == 0) {
	                    code.focus();
	                    settime();
	                    btnCheck.addClass('btnGray');
	                } else if (json.errno == 1008) {
	                    dd.dialog.alert("您将来接到电话通知您验证码，请注意查收");
	                    code.focus();
	                    settime();
	                    btnCheck.addClass('btnGray');
	                } else {
	                    $('.didi-code-alert').css('display','none');
	                    dd.dialog.alert({tip:json.errmsg,btn:{val:'确定',handler:function(){
	                       $('.didi-code-alert').css('display','block')
	                    }}});
	                }
				},
	            error:function(){
	                    $('.didi-code-alert').css('display','none');
	                    dd.dialog.alert({tip:"网络请求失败,请稍后重试",btn:{val:'确定',handler:function(){
	                       $('.didi-code-alert').css('display','block')
	                    }}});
				}
	        })
	    })
	    
	//倒计时
	    function settime() {
	        if (countdown == 0) {
	            btnCheck.removeClass('btnGray');
	            btnCheck.html("验证");
	            countdown = 60;
	            return;
	        } else {
	            btnCheck.addClass("btnGray");
	            btnCheck.html(countdown + "s");
	            countdown--;
	        }
	        setTimeout(function() {
	            settime();
	        }, 1000);
	    }

})
</script>
<script type="text/javascript">
	window.onload=function(){
		  var docHeight = parseInt(document.body.scrollHeight),
          winInHi = parseInt(window.innerHeight),
          taskB = document.getElementById('task-bottom');
     
	      if(docHeight > winInHi){
	           taskB.className="didi-task-bottom"
	      }else{
	           taskB.className="didi-task-bottom-p"
	      }
	}
</script>
<script type="text/javascript" src="/static/common/js/app-wx-share.js"></script>
<script type="text/javascript">
$(function(){
       var shareTitle = '<?php echo $shareinfo["share_title"]; ?>',
        shareDesc = '<?php  echo $shareinfo["share_wording"]; ?>',
        shareLink = '<?php  echo $shareinfo["share_url"]; ?>',
        shareImgUrl = '<?php echo $shareinfo["share_logo"]; ?>';

        initWxShare({
            title: shareTitle,
            desc: shareDesc,
            link: shareLink, 
            imgUrl: shareImgUrl 
        });
});
</script>
</body>
</html>
